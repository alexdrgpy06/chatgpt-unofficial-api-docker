FROM oott123/novnc:latest AS base\n\n\nFROM base AS chromedriver\n\nRUN apt-get update -y && \\\n    apt-get upgrade -y && \\\n    apt-get install -y wget unzip curl\nRUN apt-get install -y wget\nRUN wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\nRUN apt-get install -y ./google-chrome-stable_current_amd64.deb\nRUN wget https://chromedriver.storage.googleapis.com/108.0.5359.71/chromedriver_linux64.zip\nRUN unzip chromedriver_linux64.zip\nRUN mv chromedriver /usr/bin/chromedriver\nRUN chown root:root /usr/bin/chromedriver\nRUN chmod +x /usr/bin/chromedriver\n\nFROM chromedriver AS chatgpt\n\nRUN apt-get update \\ \n    && apt-get install -y --no-install-recommends \\\n    make build-essential libssl-dev zlib1g-dev libbz2-dev \\\n    libreadline-dev libsqlite3-dev wget ca-certificates curl \\ \n    llvm libncurses5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev \\ \n    libffi-dev liblzma-dev mecab-ipadic-utf8 git\n\nRUN groupadd -r python-user && useradd -r -m -g python-user python-user\n\n# USER python-user\n\nENV PYTHON_VERSION 3.10.0\n\n# Set-up necessary Env vars for PyEnv\nENV PYENV_ROOT /home/python-user/.pyenv\nENV PATH $PYENV_ROOT/shims:$PYENV_ROOT/bin:$PATH\n\n\n\n# Install pyenv\nRUN set -ex \\\n    && curl https://pyenv.run | bash \\\n    && pyenv update \\\n    && pyenv install $PYTHON_VERSION \\\n    && pyenv global $PYTHON_VERSION \\\n    && pyenv rehash\n\nRUN pip install --upgrade pip\n\n# COPY --chown=user:user ./requirements.txt /home/python-user/app/requirements.txt\nCOPY ./requirements.txt /home/python-user/app/requirements.txt\n\nRUN pip install --no-cache-dir --upgrade -r /home/python-user/app/requirements.txt\n\n# COPY --chown=user:user ./app /home/python-user/app\nCOPY ./app /home/python-user/app\n\n# RUN apt-get install -y git build-essential\n\nFROM chatgpt AS laststage\n\nUSER root\n\nEXPOSE 8080\n# RUN usermod -a -G user python-user\n# RUN usermod -a -G python-user user\n\n# RUN mkdir -p -m 777 /home/python-user/app\n\n# RUN touch /home/python-user/app/main.py\n# RUN touch /home/python-user/app/screenshot0.png\n# RUN touch /home/python-user/app/screenshot1.png\n# RUN touch /home/python-user/app/screenshot2.png\n# RUN touch /home/python-user/app/page_source.html\n# RUN touch /home/python-user/app/cookies.txt\n\n# RUN chown -R user:user /home/python-user/app\n\n# RUN chmod 777 /home/python-user/app\n\n# COPY --chown=user:user main.py /home/python-user/app/main.py\n\nCOPY vncmain.sh /app/vncmain.sh\n\nRUN chmod +x /app/vncmain{
